@echo off

call "%~dp0..\..\..\env.bat"

rem :: https://watch.cbc.ca/season/being-erica/season-4/047b079c-f265-431b-ab25-57ee0f7aa52a

call :cd "%~dp0.\Season 4"

call :dl "01. Dr. Who.video.mp4"                            "https://cbcvott-a.akamaihd.net/p//38e815a-00c0e020313//CBC_BEING_ERICA_SEASON_04_S04E01-v2-12425343/segments/CBC_BEING_ERICA_SEASON_04_S04E01_v7/prog_index.m3u8"
call :dl "01. Dr. Who.audio.aac"                            "https://cbcvott-a.akamaihd.net/p//38e815a-00c0e020313//CBC_BEING_ERICA_SEASON_04_S04E01-v2-12425343/segments/CBC_BEING_ERICA_SEASON_04_S04E01_a7/prog_index.m3u8"
call :mx "01. Dr. Who"

call :dl "02. Osso Barko.video.mp4"                         "https://cbcvott-a.akamaihd.net/p//38e815a-00c0e064397//CBC_BEING_ERICA_SEASON_04_S04E02-v2-12425853/segments/CBC_BEING_ERICA_SEASON_04_S04E02_v7/prog_index.m3u8"
call :dl "02. Osso Barko.audio.aac"                         "https://cbcvott-a.akamaihd.net/p//38e815a-00c0e064397//CBC_BEING_ERICA_SEASON_04_S04E02-v2-12425853/segments/CBC_BEING_ERICA_SEASON_04_S04E02_a7/prog_index.m3u8"
call :mx "02. Osso Barko"

call :dl "03. Baby Mama.video.mp4"                          "https://cbcvott-a.akamaihd.net/p//38e815a-00c183d0658//CBC_BEING_ERICA_SEASON_04_S04E03-v2-12482536/segments/CBC_BEING_ERICA_SEASON_04_S04E03_v7/prog_index.m3u8"
call :dl "03. Baby Mama.audio.aac"                          "https://cbcvott-a.akamaihd.net/p//38e815a-00c183d0658//CBC_BEING_ERICA_SEASON_04_S04E03-v2-12482536/segments/CBC_BEING_ERICA_SEASON_04_S04E03_a7/prog_index.m3u8"
call :mx "03. Baby Mama"

call :dl "04. Born this Way.video.mp4"                      "https://cbcvott-a.akamaihd.net/p//38e815a-00c1846e578//CBC_BEING_ERICA_SEASON_04_S04E04-v2-12482626/segments/CBC_BEING_ERICA_SEASON_04_S04E04_v7/prog_index.m3u8"
call :dl "04. Born this Way.audio.aac"                      "https://cbcvott-a.akamaihd.net/p//38e815a-00c1846e578//CBC_BEING_ERICA_SEASON_04_S04E04-v2-12482626/segments/CBC_BEING_ERICA_SEASON_04_S04E04_a7/prog_index.m3u8"
call :mx "04. Born this Way"

call :dl "05. Sins of the Father.video.mp4"                 "https://cbcvott-a.akamaihd.net/p//38e815a-00c18d6ebc7//CBC_BEING_ERICA_SEASON_04_S04E05-v2-12484350/segments/CBC_BEING_ERICA_SEASON_04_S04E05_v7/prog_index.m3u8"
call :dl "05. Sins of the Father.audio.aac"                 "https://cbcvott-a.akamaihd.net/p//38e815a-00c18d6ebc7//CBC_BEING_ERICA_SEASON_04_S04E05-v2-12484350/segments/CBC_BEING_ERICA_SEASON_04_S04E05_a7/prog_index.m3u8"
call :mx "05. Sins of the Father"

call :dl "06. If I Could Turn Back Time.video.mp4"          "https://cbcvott-a.akamaihd.net/p//38e815a-00c2ea2d3f5//CBC_BEING_ERICA_SEASON_04_S04E06-v3-12606877/segments/CBC_BEING_ERICA_SEASON_04_S04E06_v7/prog_index.m3u8"
call :dl "06. If I Could Turn Back Time.audio.aac"          "https://cbcvott-a.akamaihd.net/p//38e815a-00c2ea2d3f5//CBC_BEING_ERICA_SEASON_04_S04E06-v3-12606877/segments/CBC_BEING_ERICA_SEASON_04_S04E06_a7/prog_index.m3u8"
call :mx "06. If I Could Turn Back Time"

call :dl "07. Being Ethan.video.mp4"                        "https://cbcvott-a.akamaihd.net/p//38e815a-00c2fa39a84//CBC_BEING_ERICA_SEASON_04_S04E07-v3-12620290/segments/CBC_BEING_ERICA_SEASON_04_S04E07_v7/prog_index.m3u8"
call :dl "07. Being Ethan.audio.aac"                        "https://cbcvott-a.akamaihd.net/p//38e815a-00c2fa39a84//CBC_BEING_ERICA_SEASON_04_S04E07-v3-12620290/segments/CBC_BEING_ERICA_SEASON_04_S04E07_a7/prog_index.m3u8"
call :mx "07. Being Ethan"

call :dl "08. Please, Please Tell Me Now.video.mp4"         "https://cbcvott-a.akamaihd.net/p//38e815a-00c3097c7cc//CBC_BEING_ERICA_SEASON_04_S04E08-v2-12624989/segments/CBC_BEING_ERICA_SEASON_04_S04E08_v7/prog_index.m3u8"
call :dl "08. Please, Please Tell Me Now.audio.aac"         "https://cbcvott-a.akamaihd.net/p//38e815a-00c3097c7cc//CBC_BEING_ERICA_SEASON_04_S04E08-v2-12624989/segments/CBC_BEING_ERICA_SEASON_04_S04E08_a7/prog_index.m3u8"
call :mx "08. Please, Please Tell Me Now"

call :dl "09. Erica's Adventures in Wonderland.video.mp4"   "https://cbcvott-a.akamaihd.net/p//38e815a-00c31c421eb//CBC_BEING_ERICA_SEASON_04_S04E09-v2-12628670/segments/CBC_BEING_ERICA_SEASON_04_S04E09_v7/prog_index.m3u8"
call :dl "09. Erica's Adventures in Wonderland.audio.aac"   "https://cbcvott-a.akamaihd.net/p//38e815a-00c31c421eb//CBC_BEING_ERICA_SEASON_04_S04E09-v2-12628670/segments/CBC_BEING_ERICA_SEASON_04_S04E09_a7/prog_index.m3u8"
call :mx "09. Erica's Adventures in Wonderland"

call :dl "10. Purim.video.mp4"                              "https://cbcvott-a.akamaihd.net/p//38e815a-00c31cf5b5c//CBC_BEING_ERICA_SEASON_04_S04E10-v2-12628816/segments/CBC_BEING_ERICA_SEASON_04_S04E10_v7/prog_index.m3u8"
call :dl "10. Purim.audio.aac"                              "https://cbcvott-a.akamaihd.net/p//38e815a-00c31cf5b5c//CBC_BEING_ERICA_SEASON_04_S04E10-v2-12628816/segments/CBC_BEING_ERICA_SEASON_04_S04E10_a7/prog_index.m3u8"
call :mx "10. Purim"

call :dl "11. Dr. Erica (Finale).video.mp4"                 "https://cbcvott-a.akamaihd.net/p//38e815a-00c31ca2bbb//CBC_BEING_ERICA_SEASON_04_S04E11-v2-12629117/segments/CBC_BEING_ERICA_SEASON_04_S04E11_v7/prog_index.m3u8"
call :dl "11. Dr. Erica (Finale).audio.aac"                 "https://cbcvott-a.akamaihd.net/p//38e815a-00c31ca2bbb//CBC_BEING_ERICA_SEASON_04_S04E11-v2-12629117/segments/CBC_BEING_ERICA_SEASON_04_S04E11_a7/prog_index.m3u8"
call :mx "11. Dr. Erica (Finale)"

goto done

:cd
  set dirname="%~1"
  if not exist %dirname% mkdir %dirname%
  cd %dirname%
  goto :eof

:dl
  set filename=%~1
  set m3u8_url=%~2
  if not exist "%cd%\%filename%" ffmpeg -i "%m3u8_url%" -c copy -bsf:a aac_adtstoasc "%filename%"
  goto :eof

:mx
  set filename=%~1
  set in_video="%cd%\%filename%.video.mp4"
  set in_audio="%cd%\%filename%.audio.aac"
  set out_muxd="%cd%\%filename%.mp4"
  if exist %in_video% if exist %in_audio% if not exist %out_muxd% ffmpeg -i %in_video% -i %in_audio% -c copy -bsf:a aac_adtstoasc -strict experimental %out_muxd%
  if exist %out_muxd% if exist %in_video% del %in_video%
  if exist %out_muxd% if exist %in_audio% del %in_audio%
  goto :eof

:done
  echo.
  echo all downloads are complete!
  echo.
  pause
