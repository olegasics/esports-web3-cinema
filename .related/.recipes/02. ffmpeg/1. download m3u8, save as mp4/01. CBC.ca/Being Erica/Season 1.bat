@echo off

call "%~dp0..\..\..\env.bat"

rem :: https://watch.cbc.ca/season/being-erica/season-1/9536e9fb-84f4-4637-afa3-3500b05f3dc3

call :cd "%~dp0.\Season 1"

call :dl "01. Dr. Tom (Pilot).video.mp4"          "https://cbcvott-a.akamaihd.net/p//38e815a-009d46e060f//CBC_BEING_ERICA_SEASON_01_S01E01-v1-8852479/segments/CBC_BEING_ERICA_SEASON_01_S01E01_v7/prog_index.m3u8"
call :dl "01. Dr. Tom (Pilot).audio.aac"          "https://cbcvott-a.akamaihd.net/p//38e815a-009d46e060f//CBC_BEING_ERICA_SEASON_01_S01E01-v1-8852479/segments/CBC_BEING_ERICA_SEASON_01_S01E01_a7/prog_index.m3u8"
call :mx "01. Dr. Tom (Pilot)"

call :dl "02. What I Am is What I Am.video.mp4"   "https://cbcvott-a.akamaihd.net/p//38e815a-009d558ef34//CBC_BEING_ERICA_SEASON_01_S01E02-v1-8857997/segments/CBC_BEING_ERICA_SEASON_01_S01E02_v7/prog_index.m3u8"
call :dl "02. What I Am is What I Am.audio.aac"   "https://cbcvott-a.akamaihd.net/p//38e815a-009d558ef34//CBC_BEING_ERICA_SEASON_01_S01E02-v1-8857997/segments/CBC_BEING_ERICA_SEASON_01_S01E02_a7/prog_index.m3u8"
call :mx "02. What I Am is What I Am"

call :dl "03. Plenty of Fish.video.mp4"           "https://cbcvott-a.akamaihd.net/p//38e815a-009d4e057b3//CBC_BEING_ERICA_SEASON_01_S01E03-v1-8854309/segments/CBC_BEING_ERICA_SEASON_01_S01E03_v7/prog_index.m3u8"
call :dl "03. Plenty of Fish.audio.aac"           "https://cbcvott-a.akamaihd.net/p//38e815a-009d4e057b3//CBC_BEING_ERICA_SEASON_01_S01E03-v1-8854309/segments/CBC_BEING_ERICA_SEASON_01_S01E03_a7/prog_index.m3u8"
call :mx "03. Plenty of Fish"

call :dl "04. The Secret of Now.video.mp4"        "https://cbcvott-a.akamaihd.net/p//38e815a-009d4d42406//CBC_BEING_ERICA_SEASON_01_S01E04-v1-8854129/segments/CBC_BEING_ERICA_SEASON_01_S01E04_v7/prog_index.m3u8"
call :dl "04. The Secret of Now.audio.aac"        "https://cbcvott-a.akamaihd.net/p//38e815a-009d4d42406//CBC_BEING_ERICA_SEASON_01_S01E04-v1-8854129/segments/CBC_BEING_ERICA_SEASON_01_S01E04_a7/prog_index.m3u8"
call :mx "04. The Secret of Now"

call :dl "05. Adultescence.video.mp4"             "https://cbcvott-a.akamaihd.net/p//38e815a-009d3c70862//CBC_BEING_ERICA_SEASON_01_S01E05-v1-8851567/segments/CBC_BEING_ERICA_SEASON_01_S01E05_v7/prog_index.m3u8"
call :dl "05. Adultescence.audio.aac"             "https://cbcvott-a.akamaihd.net/p//38e815a-009d3c70862//CBC_BEING_ERICA_SEASON_01_S01E05-v1-8851567/segments/CBC_BEING_ERICA_SEASON_01_S01E05_a7/prog_index.m3u8"
call :mx "05. Adultescence"

call :dl "06. Til Death.video.mp4"                "https://cbcvott-a.akamaihd.net/p//38e815a-009d5463dcb//CBC_BEING_ERICA_SEASON_01_S01E06-v1-8857778/segments/CBC_BEING_ERICA_SEASON_01_S01E06_v7/prog_index.m3u8"
call :dl "06. Til Death.audio.aac"                "https://cbcvott-a.akamaihd.net/p//38e815a-009d5463dcb//CBC_BEING_ERICA_SEASON_01_S01E06-v1-8857778/segments/CBC_BEING_ERICA_SEASON_01_S01E06_a7/prog_index.m3u8"
call :mx "06. Til Death"

call :dl "07. Such a Perfect Day.video.mp4"       "https://cbcvott-a.akamaihd.net/p//38e815a-009d4acf1e1//CBC_BEING_ERICA_SEASON_01_S01E07-v1-8854094/segments/CBC_BEING_ERICA_SEASON_01_S01E07_v7/prog_index.m3u8"
call :dl "07. Such a Perfect Day.audio.aac"       "https://cbcvott-a.akamaihd.net/p//38e815a-009d4acf1e1//CBC_BEING_ERICA_SEASON_01_S01E07-v1-8854094/segments/CBC_BEING_ERICA_SEASON_01_S01E07_a7/prog_index.m3u8"
call :mx "07. Such a Perfect Day"

call :dl "08. This Be The Verse.video.mp4"        "https://cbcvott-a.akamaihd.net/p//38e815a-009d413a5ab//CBC_BEING_ERICA_SEASON_01_S01E08-v1-8851866/segments/CBC_BEING_ERICA_SEASON_01_S01E08_v7/prog_index.m3u8"
call :dl "08. This Be The Verse.audio.aac"        "https://cbcvott-a.akamaihd.net/p//38e815a-009d413a5ab//CBC_BEING_ERICA_SEASON_01_S01E08-v1-8851866/segments/CBC_BEING_ERICA_SEASON_01_S01E08_a7/prog_index.m3u8"
call :mx "08. This Be The Verse"

call :dl "09. Everything She Wants.video.mp4"     "https://cbcvott-a.akamaihd.net/p//38e815a-009d5472dea//CBC_BEING_ERICA_SEASON_01_S01E09-v1-8857966/segments/CBC_BEING_ERICA_SEASON_01_S01E09_v7/prog_index.m3u8"
call :dl "09. Everything She Wants.audio.aac"     "https://cbcvott-a.akamaihd.net/p//38e815a-009d5472dea//CBC_BEING_ERICA_SEASON_01_S01E09-v1-8857966/segments/CBC_BEING_ERICA_SEASON_01_S01E09_a7/prog_index.m3u8"
call :mx "09. Everything She Wants"

call :dl "10. Mi Casa, Su Casa Loma.video.mp4"    "https://cbcvott-a.akamaihd.net/p//38e815a-009d56b41d8//CBC_BEING_ERICA_SEASON_01_S01E10-v1-8858346/segments/CBC_BEING_ERICA_SEASON_01_S01E10_v7/prog_index.m3u8"
call :dl "10. Mi Casa, Su Casa Loma.audio.aac"    "https://cbcvott-a.akamaihd.net/p//38e815a-009d56b41d8//CBC_BEING_ERICA_SEASON_01_S01E10-v1-8858346/segments/CBC_BEING_ERICA_SEASON_01_S01E10_a7/prog_index.m3u8"
call :mx "10. Mi Casa, Su Casa Loma"

call :dl "11. She's Lost Control.video.mp4"       "https://cbcvott-a.akamaihd.net/p//38e815a-009d4802f50//CBC_BEING_ERICA_SEASON_01_S01E11-v1-8852711/segments/CBC_BEING_ERICA_SEASON_01_S01E11_v7/prog_index.m3u8"
call :dl "11. She's Lost Control.audio.aac"       "https://cbcvott-a.akamaihd.net/p//38e815a-009d4802f50//CBC_BEING_ERICA_SEASON_01_S01E11-v1-8852711/segments/CBC_BEING_ERICA_SEASON_01_S01E11_a7/prog_index.m3u8"
call :mx "11. She's Lost Control"

call :dl "12. Erica the Vampire Slayer.video.mp4" "https://cbcvott-a.akamaihd.net/p//38e815a-009d9e54547//CBC_BEING_ERICA_SEASON_01_S01E12-v1-8896384/segments/CBC_BEING_ERICA_SEASON_01_S01E12_v7/prog_index.m3u8"
call :dl "12. Erica the Vampire Slayer.audio.aac" "https://cbcvott-a.akamaihd.net/p//38e815a-009d9e54547//CBC_BEING_ERICA_SEASON_01_S01E12-v1-8896384/segments/CBC_BEING_ERICA_SEASON_01_S01E12_a7/prog_index.m3u8"
call :mx "12. Erica the Vampire Slayer"

call :dl "13. Leo.video.mp4"                      "https://cbcvott-a.akamaihd.net/p//38e815a-009d9df1ce0//CBC_BEING_ERICA_SEASON_01_S01E13-v1-8896382/segments/CBC_BEING_ERICA_SEASON_01_S01E13_v7/prog_index.m3u8"
call :dl "13. Leo.audio.aac"                      "https://cbcvott-a.akamaihd.net/p//38e815a-009d9df1ce0//CBC_BEING_ERICA_SEASON_01_S01E13-v1-8896382/segments/CBC_BEING_ERICA_SEASON_01_S01E13_a7/prog_index.m3u8"
call :mx "13. Leo"

goto done

:cd
  set dirname="%~1"
  if not exist %dirname% mkdir %dirname%
  cd %dirname%
  goto :eof

:dl
  set filename=%~1
  set m3u8_url=%~2
  if not exist "%cd%\%filename%" ffmpeg -i "%m3u8_url%" -c copy -bsf:a aac_adtstoasc "%filename%"
  goto :eof

:mx
  set filename=%~1
  set in_video="%cd%\%filename%.video.mp4"
  set in_audio="%cd%\%filename%.audio.aac"
  set out_muxd="%cd%\%filename%.mp4"
  if exist %in_video% if exist %in_audio% if not exist %out_muxd% ffmpeg -i %in_video% -i %in_audio% -c copy -bsf:a aac_adtstoasc -strict experimental %out_muxd%
  if exist %out_muxd% if exist %in_video% del %in_video%
  if exist %out_muxd% if exist %in_audio% del %in_audio%
  goto :eof

:done
  echo.
  echo all downloads are complete!
  echo.
  pause
